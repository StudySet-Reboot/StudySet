<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>StudySet-과제 상세</title>
    <link rel="shortcut icon" th:href="@{/favicon_io/apple-touch-icon.png}" type="image/png">
    <link rel="stylesheet" th:href="@{/style/header.css}">
    <link rel="stylesheet" th:href="@{/style/task/taskDetail.css}">
    <link rel="stylesheet" th:href="@{https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/all.min.css}"/>
</head>
<body>
<!-- header 삽입 -->
<div th:replace="thyme/group/groupHeader :: groupHeader (group=${group})"></div>

<div class="task">
    <!-- 과제 제목 -->
    <div class="title">
        <div class="taskName" th:text="${task.taskName}"></div>
    </div>

    <!-- 과제 설명 -->
    <div class="frame">
        <div class="description">
            <div class="description" th:text="${task.description}" style="white-space: pre-wrap;"></div>
        </div>
    </div>

    <!-- userList -->
    <div class="frame frame2">
        <div th:each="user : ${userList}"
             th:classappend="${taskSubmissionMap.containsKey(user.id)} ? 'user-frame submitted' : 'user-frame no-submission'">

            <!-- 과제를 제출한 경우 -->
            <div class="task-details">
                <!-- 제출된 과제에 대한 링크 -->
                <span th:if="${taskSubmissionMap.containsKey(user.id)}" class="task-info">
                    <a th:href="@{/groups/{groupId}/tasks/{taskId}/{userId}/usertask(groupId=${group.id}, taskId=${task.id}, userId=${user.id})}"
                       class="no-link-style">
                        <span class="user-title" th:text="${user.name}"></span>
                        <span class="submit-date" th:text="${taskSubmissionMap[user.id].updatedDate}"></span>
                        <span class="task-end-time" th:text="${task.endTimeFormatted}">End Date</span>
                    </a>
                    <!-- 제출 버튼: 로그인 유저일 때만 표시되며, 항상 자리를 차지 -->
                    <span class="submit-button-wrapper">
                        <a th:if="${user.id == loginUser.id}"
                           th:href="@{/groups/{groupId}/tasks/{taskId}/submit-modify(groupId=${group.id}, taskId=${task.id})}"
                           class="submit-button">제출</a>
                        <span th:unless="${user.id == loginUser.id}" class="submit-button-placeholder"></span>
                    </span>
                </span>

                <!-- 과제를 제출하지 않은 경우 -->
                <span th:if="${!taskSubmissionMap.containsKey(user.id)}" class="task-info">
                    <a class="no-link-style">
                        <span class="user-title" th:text="${user.name}"></span>
                        <span class="submit-date">미제출</span>
                        <span class="task-end-time" th:text="${task.endTimeFormatted}">End Date</span>
                    </a>
                    <!-- 제출 버튼: 로그인 유저일 때만 표시되며, 항상 자리를 차지 -->
                    <span class="submit-button-wrapper">
                        <a th:if="${user.id == loginUser.id}
                            and ${task.endTime.isAfter(T(java.time.LocalDate).now())}"
                           th:href="@{/groups/{groupId}/tasks/{taskId}/submit-modify(groupId=${group.id}, taskId=${task.id})}"
                           class="submit-button">제출</a>
                        <span th:unless="${user.id == loginUser.id}" class="submit-button-placeholder"></span>
                    </span>
                </span>
            </div>
        </div>
    </div>
</div>
</body>
</html>